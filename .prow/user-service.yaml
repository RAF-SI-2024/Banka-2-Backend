presubmits:
    - name: pull-banka-2-backend-user-service-test
      run_if_changed: "(Bank.UserService/|Scripts/compose.yaml|.prow/)"
      decorate: true
      labels:
          preset-banka-2-backend-env: "true"
      spec:
          containers:
              - image: harbor.k8s.elab.rs/base-images/base:dotnet-9-node-22-docker
                command:
                    - /bin/bash
                    - -c
                    - |
                        set -euo pipefail
                        start-docker.sh
                        
                        cp /banka-2-backend-env/env Scripts/.env
                        cp /banka-2-backend-env/database.env Scripts/Environments/database.env
                        cp /banka-2-backend-env/user.env Scripts/Environments/user.env
                        
                        cp /banka-2-backend-env/user-test.env Bank.UserService.Test/.env
                        
                        docker compose -f ./Scripts/compose.yaml up -d --wait user_database
                        docker compose -f ./Scripts/compose.yaml up -d --wait user_service
                        
                        cd "Bank.UserService.Test"
                        
                        dotnet test
                securityContext:
                    privileged: true
                imagePullPolicy: Always